# 积木式开发流程总览

```
📍 积木开始
📍 积木执行
📍 AI自行验证
📍 积木完成
📍 用户验证通过后
```

# 开发流程

## 📍 积木开始
🎯 **当前积木**：<名称>
📋 **开发计划**：<简要描述本积木要完成的功能和目标>
📁 **涉及目录**：<列出本积木会修改/创建的主要目录和文件>
⚡ **输入输出**：<明确输入参数、前置条件、输出产物>
✅ **验收方式**：<如何验证、在哪里验证>

## 📍 积木执行
🛠️ **实施步骤**：<具体的开发步骤和实现方案>
📊 **进度更新**：<关键节点的进度汇报>
🐛 **问题记录**：<遇到的问题和解决方案>

## 📍 AI自行验证
🔍 **验证地址**：<展示积木效果的链接/路径>
🧪 **测试结果**：<运行测试的结果>

## 📍 积木完成
🔍 **验证地址**：<展示积木效果的链接/路径>
🧪 **测试结果**：<运行测试的结果>

## 📍 用户验证通过后
💾 **代码提交**：<commit信息>
➡️ **后续积木**：<列出下一步可选的积木>
📦 **积木统一登记（all-blocks）**
- 统一登记位置：`docs/all-blocks.md`
- 必填字段：积木名称、唯一ID、域路径、功能摘要、对外契约（接口/DTO/事件/错误码）链接、上游依赖、下游影响、版本、状态、负责人、验收入口、创建/最近验证时间。
- 操作要求：在统一登记文件中追加或更新对应条目，保持版本化与可追溯。

登记模板：
```md

----
## <block-id> - <block-name>
- Domain: `<domain>/<block>/`
- Summary: <一句话功能概述>
- Contracts (exports): <链接列表>
- Upstream Dependencies: [<block-id>]
- Downstream Impact: [<block-id>]
- Version: vX.Y.Z
- Status: active | deprecated | experimental
- Owner: <name/team>
- Acceptance: <link/path>
- CreatedAt: YYYY-MM-DD
- LastVerifiedAt: YYYY-MM-DD
-----
```

---

# 积木解释

* **定义**：代码中最小、可组合、可验收的单元。
* **约束**：每个积木**必须**写清 **输入**（参数/前置/依赖）与 **输出**（产物/可观测结果），并在开始时声明**验收结果展示**：完成后**在哪里/如何**验收（链接/命令/路径/脚本）。
* **实施**：积木**内部实现由 AI 自主制定**（设计/实现/测试方式灵活），但对外以固定格式汇报。



# 分类与目录规范

- 文档类：归档于 `docs/`，每个积木独立子目录维护（示例：`docs/<topic-or-block>/README.md`）。
- 代码类：归档于 `<domain>/<block>/`，具体源码置于对应积木目录下，并提供同层导出层 `index.xx`。
- 契约优先：实现前先定义对外接口（协议/类型/DTO/事件/错误码），冻结并评审后再实现；实现严格遵循契约。
- 单向依赖：架构层仅通过契约依赖积木；积木实现不得反向依赖架构层，仅可依赖通用基础库与契约。
- 积木统一登记：在 `docs/all-blocks.md` 以版本/时间维度维护每个积木的元数据与演进记录（名称、域路径、契约、依赖、状态、验收入口、负责人、版本等）。


# 原则（积木驱动）

1. **积木驱动主线**：所有工作以“积木”为单位推进；先定义积木，再实施与验收。
2. **单积木可验证**：每个积木都要有**清晰验收标准**与**可执行的验证步骤**（自动/手动），完成即验收并记录。
3. **以终为始的验收结果展示**（新增必遵）：开始时就固定验收入口（链接/命令/路径/脚本）与判定口径。
4. **即时验证**：每步完成必须运行对应测试/脚本（单测/集成/端到端），确保正确。
5. **智能记录 + 强制记录**：高信噪比记录决策/问题/方案/发现；**所有步骤**写入 `dev-log/{claude-code-session-ID}/{写入时间}.md`。
   1. 注意不同的 devlog 用 `----`  进行分割
6. **目录即架构；架构可灵活**：以目录体现模块边界，按项目选择合适架构。
7. **代码规模约束**：单文件 ≤ 500 行；单函数 ≤ 80 行。
8. **提交规范**：完成积木即提交：`task(<目录名>): <动词结果>`。
9.  **统一导出**：同层目录提供 `index.xx` 做 re-export，避免 import 路径爆炸。
10. **依赖边界**：禁止循环依赖；功能域仅经公开接口通信。
11. **防御性编程**：外部数据校验；异步错误处理；用户输入转义；文件操作校验路径合法性。
12. **步骤透明**：到达每个关键步骤时须对外标注与说明（便于协作与追踪）。
13. **每个积木完成后提commit**：完成每个积木后提交commit。
14. 先给用户展示验证地址， 再提交代码。 
15. 积木分类与目录：文档类→`docs/`；代码类→`<domain>/<block>/`。
16. 契约优先：先定接口与判定口径，再实现，变更须评审。
17. 单向依赖（架构→契约→实现）：禁止实现层引用架构层。
18. 代码类仍遵循项目最佳架构；积木只通过契约被引用。
19. 积木开发原则： TDD开发+契约优先
20. 积木统一登记：用户验证通过后，更新 `docs/all-blocks.md` 登记与版本记录。


# 模式选择

在开始写代码时， 与用户确认 