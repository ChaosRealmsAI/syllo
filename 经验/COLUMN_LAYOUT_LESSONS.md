# TipTap å¤šåˆ—å¸ƒå±€å®ç° - å¤±è´¥ç»éªŒä¸æ•™è®­

## ğŸ“‹ é¡¹ç›®èƒŒæ™¯

**ç›®æ ‡**ï¼šä¸º TipTap ç¼–è¾‘å™¨å®ç°å¤šåˆ—å¸ƒå±€åŠŸèƒ½ï¼Œæ”¯æŒé€šè¿‡æ‹–æ‹½åˆ›å»ºå’Œç®¡ç†å¤šåˆ—å†…å®¹ã€‚

**éœ€æ±‚**ï¼š
- åˆ—å¸ƒå±€æ˜¯å®¹å™¨ï¼Œä¸å¯è¢«æ‹–æ‹½
- åˆ—å†…çš„å†…å®¹å—å¯ä»¥è¢«æ‹–æ‹½
- æ”¯æŒåˆ›å»º 2-5 åˆ—å¸ƒå±€
- æ‹–æ‹½åˆ°å—è¾¹ç¼˜åˆ›å»ºåˆ—ï¼Œæ‹–æ‹½åˆ°åˆ—å†…ç§»åŠ¨å†…å®¹

## ğŸ”´ é‡åˆ°çš„é—®é¢˜

### é—®é¢˜æè¿°
å®ç°å¤šåˆ—å¸ƒå±€åï¼Œæ‹–æ‹½å¥æŸ„å‡ºç°åœ¨åˆ—å®¹å™¨ä¸Šï¼Œè€Œä¸æ˜¯åˆ—å†…çš„å†…å®¹å—ä¸Šã€‚å¯¼è‡´ï¼š
- âŒ æ•´ä¸ªåˆ—è¢«æ‹–æ‹½ï¼ˆè¿èƒŒè®¾è®¡ï¼‰
- âŒ åˆ—å†…å®¹æ— æ³•å•ç‹¬æ‹–æ‹½
- âŒ ç ´åäº†"åˆ—åªæ˜¯å®¹å™¨"çš„æ ¸å¿ƒåŸåˆ™

## âŒ å¤±è´¥åŸå› åˆ†æ

### 1. å¯¹ ProseMirror æœºåˆ¶ç†è§£ä¸è¶³

```typescript
// âŒ é”™è¯¯è®¤çŸ¥
const Column = Node.create({
  draggable: false,  // ä»¥ä¸ºè¿™æ ·å°±å¤Ÿäº†
})
```

**å®é™…æƒ…å†µ**ï¼š
- `draggable: false` åªå½±å“ ProseMirror åŸç”Ÿæ‹–æ‹½
- è‡ªå®šä¹‰æ‹–æ‹½å¥æŸ„ç³»ç»Ÿéœ€è¦ç‹¬ç«‹å¤„ç†
- ä¸¤ä¸ªç³»ç»Ÿä¹‹é—´æ²¡æœ‰è‡ªåŠ¨è”åŠ¨

### 2. é”™è¯¯çš„è§£å†³æ–¹å‘

```typescript
// âŒ åœ¨æ‹–æ‹½ç³»ç»Ÿä¸­ç¡¬ç¼–ç 
if (outerNode.type.name === 'column' ||
    outerNode.type.name === 'columnLayout') {
  hideHandle()
}
```

**é—®é¢˜**ï¼š
- è¿åå¼€æ”¾å°é—­åŸåˆ™
- å¢åŠ ç³»ç»Ÿè€¦åˆåº¦
- ä¸å¯æ‰©å±•ï¼ˆæ¯ä¸ªæ–°å®¹å™¨éƒ½è¦æ”¹ä»£ç ï¼‰

### 3. DOM ç»“æ„æ§åˆ¶ä¸å½“

```typescript
// âŒ ç®€å•ä½¿ç”¨ ReactNodeViewRenderer
addNodeView() {
  return ReactNodeViewRenderer(ColumnComponent)
}
```

æ²¡æœ‰æ­£ç¡®æ§åˆ¶ DOM ç»“æ„ï¼Œå¯¼è‡´æ‹–æ‹½ç³»ç»Ÿæ— æ³•åŒºåˆ†å®¹å™¨å’Œå†…å®¹ã€‚

### 4. æµ‹è¯•åœºæ™¯ä¸å®Œæ•´

- âœ… æµ‹è¯•äº†åˆ—å¸ƒå±€åˆ›å»º
- âŒ æ²¡æµ‹è¯•åˆ—å†…æ‹–æ‹½
- âŒ æ²¡éªŒè¯æ‹–æ‹½å¥æŸ„æ˜¾ç¤º
- âŒ æ²¡æµ‹è¯•è¾¹ç•Œæƒ…å†µ

## ğŸ“š æ ¸å¿ƒæ•™è®­

### 1. ç³»ç»Ÿè¾¹ç•Œç†è§£

```
ProseMirror å±‚
â”œâ”€â”€ draggable å±æ€§
â”œâ”€â”€ èŠ‚ç‚¹è§„èŒƒ
â””â”€â”€ é€‰æ‹©ç³»ç»Ÿ

è‡ªå®šä¹‰æ‹–æ‹½å±‚
â”œâ”€â”€ æ‹–æ‹½å¥æŸ„æ˜¾ç¤º
â”œâ”€â”€ æ‹–æ‹½æ£€æµ‹é€»è¾‘
â””â”€â”€ è§†è§‰åé¦ˆ

DOM å±‚
â”œâ”€â”€ å…ƒç´ å±æ€§
â”œâ”€â”€ äº‹ä»¶å¤„ç†
â””â”€â”€ CSS æ ·å¼
```

**æ•™è®­**ï¼šä¸‰ä¸ªå±‚æ¬¡éœ€è¦ååŒå·¥ä½œï¼Œä¸èƒ½åªæ”¹ä¸€å±‚ã€‚

### 2. æ¶æ„è®¾è®¡åŸåˆ™

#### âŒ é”™è¯¯ï¼šå‘½ä»¤å¼è®¾è®¡
```typescript
// ç³»ç»Ÿå‘Šè¯‰èŠ‚ç‚¹æ€ä¹ˆåš
if (isColumnNode(node)) {
  doNotShowDragHandle()
}
```

#### âœ… æ­£ç¡®ï¼šå£°æ˜å¼è®¾è®¡
```typescript
// èŠ‚ç‚¹å‘Šè¯‰ç³»ç»Ÿè‡ªå·±çš„ç‰¹æ€§
const Column = Node.create({
  draggable: false,
  attrs: {
    isDragContainer: true
  }
})
```

### 3. åˆ†ç¦»å…³æ³¨ç‚¹

```typescript
// æ‹–æ‹½ç³»ç»Ÿï¼šåªå…³å¿ƒ"èƒ½å¦æ‹–æ‹½"
const canDrag = node.type.spec.draggable !== false

// èŠ‚ç‚¹å®šä¹‰ï¼šå£°æ˜è‡ªå·±çš„è¡Œä¸º
const Column = {
  draggable: false,  // æˆ‘ä¸èƒ½è¢«æ‹–æ‹½
  selectable: false, // æˆ‘ä¸èƒ½è¢«é€‰ä¸­
}
```

## âœ… æ­£ç¡®çš„è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ 1ï¼šé€šç”¨æ ‡è®°æœºåˆ¶ï¼ˆæ¨èï¼‰

```typescript
// èŠ‚ç‚¹æ ‡è®°è‡ªå·±
const Column = Node.create({
  addNodeView() {
    return () => {
      const dom = document.createElement('div')
      dom.setAttribute('data-drag-container', 'true')
      return { dom }
    }
  }
})

// æ‹–æ‹½ç³»ç»Ÿè¯†åˆ«æ ‡è®°
if (element.hasAttribute('data-drag-container')) {
  // è·³è¿‡å®¹å™¨ï¼ŒæŸ¥æ‰¾å†…éƒ¨å†…å®¹
}
```

### æ–¹æ¡ˆ 2ï¼šèŠ‚ç‚¹è§„èŒƒæ£€æŸ¥

```typescript
// æ‹–æ‹½ç³»ç»Ÿæ£€æŸ¥èŠ‚ç‚¹è§„èŒƒ
const spec = editor.state.schema.nodes[nodeName].spec
if (spec.draggable === false) {
  hideHandle()
}
```

### æ–¹æ¡ˆ 3ï¼šç™½åå•æœºåˆ¶

```typescript
// åªä¸ºç‰¹å®šèŠ‚ç‚¹æ˜¾ç¤ºæ‹–æ‹½å¥æŸ„
const DRAGGABLE_NODES = ['paragraph', 'heading', 'blockquote', 'codeBlock']
if (!DRAGGABLE_NODES.includes(node.type.name)) {
  hideHandle()
}
```

## ğŸ¯ æœ€ä½³å®è·µ

### 1. èŠ‚ç‚¹å®šä¹‰æ¸…æ™°

```typescript
const Column = Node.create({
  name: 'column',
  group: 'container',      // æ˜ç¡®åˆ†ç»„
  draggable: false,        // ä¸å¯æ‹–æ‹½
  selectable: false,       // ä¸å¯é€‰ä¸­
  defining: true,          // å®šä¹‰æ€§èŠ‚ç‚¹
  isolating: true,         // éš”ç¦»å†…å®¹
})
```

### 2. DOM ç»“æ„è¯­ä¹‰åŒ–

```html
<div data-column-layout="true" data-columns="2">
  <div data-column="true" data-drag-container="true">
    <div data-content="true">
      <!-- å®é™…å¯æ‹–æ‹½çš„å†…å®¹ -->
    </div>
  </div>
</div>
```

### 3. å¢é‡å¼€å‘ä¸æµ‹è¯•

```typescript
describe('Column Layout', () => {
  test('åˆ—å®¹å™¨ä¸æ˜¾ç¤ºæ‹–æ‹½å¥æŸ„')
  test('åˆ—å†…å†…å®¹æ˜¾ç¤ºæ‹–æ‹½å¥æŸ„')
  test('å¯ä»¥æ‹–æ‹½å†…å®¹åˆ°åˆ—ä¸­')
  test('å¯ä»¥ä»åˆ—ä¸­æ‹–å‡ºå†…å®¹')
  test('ç©ºåˆ—è‡ªåŠ¨æ¸…ç†')
})
```

## ğŸ’¡ å…³é”®é¢†æ‚Ÿ

### 1. å£°æ˜å¼ > å‘½ä»¤å¼
è®©èŠ‚ç‚¹å£°æ˜è‡ªå·±çš„ç‰¹æ€§ï¼Œè€Œä¸æ˜¯ç³»ç»Ÿåˆ¤æ–­èŠ‚ç‚¹ç±»å‹ã€‚

### 2. ç»„åˆ > ç»§æ‰¿
é€šè¿‡ç»„åˆå¤šä¸ªç®€å•æœºåˆ¶å®ç°å¤æ‚åŠŸèƒ½ï¼Œè€Œä¸æ˜¯åˆ›å»ºå¤æ‚çš„å•ä¸€ç³»ç»Ÿã€‚

### 3. æ ‡å‡† > è‡ªå®šä¹‰
ä¼˜å…ˆä½¿ç”¨ ProseMirror æ ‡å‡†æœºåˆ¶ï¼Œå¿…è¦æ—¶æ‰è‡ªå®šä¹‰ã€‚

## ğŸ“Š å½±å“è¯„ä¼°

| æ–¹é¢ | é”™è¯¯åšæ³•çš„å½±å“ | æ­£ç¡®åšæ³•çš„æ”¶ç›Š |
|------|--------------|--------------|
| å¯ç»´æŠ¤æ€§ | æ¯æ¬¡æ·»åŠ å®¹å™¨éƒ½è¦æ”¹æ‹–æ‹½ç³»ç»Ÿ | èŠ‚ç‚¹è‡ªæè¿°ï¼Œæ— éœ€æ”¹åŠ¨ç³»ç»Ÿ |
| æ‰©å±•æ€§ | ç¡¬ç¼–ç é™åˆ¶æ‰©å±• | é€šç”¨æœºåˆ¶æ”¯æŒä»»æ„æ‰©å±• |
| è€¦åˆåº¦ | ç³»ç»Ÿé—´é«˜åº¦è€¦åˆ | å„å±‚ç‹¬ç«‹ï¼Œä½è€¦åˆ |
| æµ‹è¯• | éœ€è¦å¤§é‡é›†æˆæµ‹è¯• | å¯å•ç‹¬æµ‹è¯•å„ç»„ä»¶ |

## ğŸ”„ åç»­æ”¹è¿›

1. **å»ºç«‹èŠ‚ç‚¹åˆ†ç±»ç³»ç»Ÿ**
   - content: å†…å®¹èŠ‚ç‚¹ï¼ˆå¯æ‹–æ‹½ï¼‰
   - container: å®¹å™¨èŠ‚ç‚¹ï¼ˆä¸å¯æ‹–æ‹½ï¼‰
   - decoration: è£…é¥°èŠ‚ç‚¹ï¼ˆä¸å¯æ‹–æ‹½ï¼‰

2. **å®Œå–„æ‹–æ‹½ç³»ç»Ÿ**
   - æ”¯æŒèŠ‚ç‚¹è§„èŒƒè‡ªåŠ¨è¯†åˆ«
   - æä¾›æ‹–æ‹½è¡Œä¸ºé…ç½®æ¥å£
   - å¢åŠ æ‹–æ‹½äº‹ä»¶é’©å­

3. **æ–‡æ¡£ä¸ç¤ºä¾‹**
   - åˆ›å»ºå®¹å™¨èŠ‚ç‚¹æœ€ä½³å®è·µ
   - æ‹–æ‹½ç³»ç»Ÿé›†æˆæŒ‡å—
   - å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆ

## ğŸ“ æ€»ç»“

è¿™æ¬¡å¤±è´¥çš„æ ¹æœ¬åŸå› æ˜¯**æ²¡æœ‰æ­£ç¡®ç†è§£ç³»ç»Ÿè¾¹ç•Œå’ŒèŒè´£åˆ†ç¦»**ã€‚è¯•å›¾é€šè¿‡ä¿®æ”¹å•ä¸€å±‚æ¬¡è§£å†³å¤šå±‚æ¬¡é—®é¢˜ï¼Œå¯¼è‡´æ–¹æ¡ˆä¸å®Œæ•´ã€‚

**æ ¸å¿ƒæ•™è®­**ï¼š
> å¥½çš„æ¶æ„åº”è¯¥è®©æ­£ç¡®çš„äº‹æƒ…å®¹æ˜“åšï¼Œé”™è¯¯çš„äº‹æƒ…éš¾ä»¥åšã€‚èŠ‚ç‚¹åº”è¯¥è‡ªå·±å£°æ˜è¡Œä¸ºï¼Œç³»ç»Ÿåº”è¯¥è¯†åˆ«å’Œå“åº”è¿™äº›å£°æ˜ï¼Œè€Œä¸æ˜¯ç¡¬ç¼–ç åˆ¤æ–­ã€‚

---

*æ–‡æ¡£åˆ›å»ºæ—¶é—´ï¼š2024-09-23*
*é¡¹ç›®ï¼šTipTap å¤šåˆ—å¸ƒå±€æ‰©å±•*