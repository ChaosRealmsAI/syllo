# 拖拽系统设计

## 初始状态
```
┌─────────────────────────────────┐
│ ⋮  段落块 1                      │
├─────────────────────────────────┤
│ ⋮  标题块 2                      │
├─────────────────────────────────┤
│ ⋮  列表块 3                      │
│    • 列表项 A                    │
│    • 列表项 B                    │
├─────────────────────────────────┤
│ ⋮  图片块 4                      │
└─────────────────────────────────┘
```

## 两种拖拽模式

### 模式1：纵向移动（上下调换顺序）

拖拽段落块1到标题块2下方：

```
结果：
┌─────────────────────────────────┐
│ ⋮  标题块 2                      │  ← 移到上面了
├─────────────────────────────────┤
│ ⋮  段落块 1                      │  ← 移到下面了
├─────────────────────────────────┤
│ ⋮  列表块 3                      │
│    • 列表项 A                    │
│    • 列表项 B                    │
├─────────────────────────────────┤
│ ⋮  图片块 4                      │
└─────────────────────────────────┘
```

**视觉提示**：拖拽时显示蓝色横线 ━━━

### 模式2：横向布局（左右并列）

拖拽段落块1到标题块2左边：

```
结果：
├─────────────────────────────────┤
│ ⋮  段落块 1  │ ⋮  标题块 2       │  ← 变成两列
├─────────────────────────────────┤
│ ⋮  列表块 3                      │
│    • 列表项 A                    │
│    • 列表项 B                    │
├─────────────────────────────────┤
│ ⋮  图片块 4                      │
└─────────────────────────────────┘
```

**视觉提示**：拖拽时显示蓝色竖线 ┃

## 重要：列的规则

### ✅ 可以做的

#### 1. 在同一行增加更多列（最多3列）
```
两列状态：
├─────────────────────────────────┤
│ ⋮  段落块 1  │ ⋮  标题块 2       │
├─────────────────────────────────┤

拖图片块4到这一行：
├─────────────────────────────────┤
│ 段落块1 │ 标题块2 │ 图片块4      │  ← 变成3列 ✅
├─────────────────────────────────┤
```

#### 2. 在列内纵向添加内容
```
├─────────────────────────────────┤
│ ⋮  段落块 1  │ ⋮  标题块 2       │
│              │ ⋮  新增块 A       │  ← 列内可以上下排列 ✅
│              │ ⋮  新增块 B       │
├─────────────────────────────────┤
```

### ❌ 禁止做的

#### 列内不能再创建列！
```
├─────────────────────────────────┤
│ 段落块 1  │ 标题块 2              │
│          │ ┌──────┬──────┐      │
│          │ │ 块A  │ 块B  │      │  ← 列内不能再分列 ❌
│          │ └──────┴──────┘      │
├─────────────────────────────────┤

正确做法：应该在同一行变成3列
├─────────────────────────────────┤
│ 段落块1 │ 标题块2 │ 新块         │  ← 这样才对 ✅
├─────────────────────────────────┤
```

## 检测逻辑

```
拖拽到已有列布局时：
├─ 拖到列的边缘 → 在同一行添加新列（最多3列）
├─ 拖到列的内部 → 只能纵向插入（上下排列）
└─ 绝不允许 → 列内创建子列
```

## 什么能拖动，什么不能

### ✅ 可拖动的（有拖拽句柄 ⋮）
- 段落块
- 标题块
- 列表块
- 图片块
- 代码块
- 引用块

### ❌ 不可拖动的（没有拖拽句柄）
```
├─────────────────────────────────┤
│ 段落块1 │ 标题块2 │ 图片块4      │  ← 列容器本身不能拖动
├─────────────────────────────────┤
    ↑         ↑         ↑
  可拖动    可拖动     可拖动

    ←── 整个列布局 ──→
       不可拖动！
```

**重要**：列只是一个容器，不是块。只有块才能拖动！

## 简单规则总结

1. **主文档流**：可以创建列布局
2. **列内部**：只能纵向排列，不能再分列
3. **最多5列**：一行最多并列5个块
4. **列不能拖动**：列是容器，不是内容块
5. **只有块能拖**：段落、标题、图片等才有拖拽句柄
6. **横线** = 纵向插入
7. **竖线** = 横向创建列